cmake_minimum_required(VERSION 3.31)
project(CatTests)

# ì „ì²´ í”„ë¡œì íŠ¸ì— ì»´íŒŒì¼ ì˜µì…˜ ì¶”ê°€
add_compile_options(-Wall -Wextra)

# ======================
# CTest ëª…ë ¹ì–´ë¡œ ì—¬ëŸ¬ê°œì˜ í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ í•œë²ˆì— ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
enable_testing()


# ======================
# GoogleTest í´ë” ì¶”ê°€ ğŸ‰
add_subdirectory(googletest)


# ======================
# í—¤ë” íŒŒì¼ ê¸°ë³¸ ê²€ìƒ‰ ê²½ë¡œ
include_directories(${CMAKE_SOURCE_DIR}/../include)
# âœ… iot.cc, Cat.cc, ë“± ì—¬ëŸ¬ê³³ì—ì„œ ì“°ì´ë¯€ë¡œ ê¸°ë³¸ ê²€ìƒ‰ ê²½ë¡œë¡œ ì„¤ì •í•œë‹¤.
include_directories(${CMAKE_SOURCE_DIR}/../libs)


# ======================
# ë¼ì´ë¸ŒëŸ¬ë¦¬ ë§Œë“¤ê¸°
# ìµœìƒë‹¨ CMakeLists.txtì™€ëŠ” ë³„ê°œì˜ íŒŒì¼ì´ë¯€ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë‹¤ì‹œ ì •ì˜í•œë‹¤.
add_library(iot_lib ${CMAKE_SOURCE_DIR}/../libs/iot.cc)
# í…ŒìŠ¤íŠ¸ ì½”ë“œ ì…ì¥ì—ì„œëŠ” í…ŒìŠ¤íŠ¸í•˜ë ¤ëŠ” êµ¬í˜„ì²´ ì½”ë“œë„ ê²°êµ­ importí•´ì˜¤ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤.
add_library(cat_module ${CMAKE_SOURCE_DIR}/../src/Cat.cc)


# ======================
# í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„± ğŸ“
add_executable(CatTest CatTest.cc)


# ======================
# GoogleTest ë° GoogleMock ë¼ì´ë¸ŒëŸ¬ë¦¬ ë§í¬
target_link_libraries(CatTest PRIVATE gtest_main gmock_main cat_module iot_lib)

# ======================
# CTest ëª…ë ¹ì–´ë¡œ ì—¬ëŸ¬ê°œì˜ í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ í•œë²ˆì— ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.
add_test(NAME CatTest COMMAND CatTest)


# ======================
# Mocking ì²«ë²ˆì§¸ ì˜ˆì œ - íŒŒì¼ì„ êµì²´í•˜ê¸°
add_executable(CatTest2_Mock CatTest2_Mock.cc)
add_library(mock_iot_lib ${CMAKE_SOURCE_DIR}/mock/iot_mock.cc)
target_link_libraries(CatTest2_Mock PRIVATE gtest_main gmock_main cat_module mock_iot_lib)

add_test(NAME CatTest2_Mock COMMAND CatTest2_Mock)


# ======================
# Mocking ë‘ë²ˆì§¸ ì˜ˆì œ - ê°’ì„ ì¡°ì‘í•˜ê¸° (êµ¬í˜„ íŒŒì¼ êµì²´ ë° ì „ì—­ ë³€ìˆ˜ í™œìš©)
add_library(mock_dyn_iot_lib ${CMAKE_SOURCE_DIR}/mock/iot_mock_dynamic.cc)
include_directories(mock_dyn_iot_lib PUBLIC ${CMAKE_SOURCE_DIR}/mock/)
add_executable(CatTest3_Mock_Dynamic CatTest3_Mock_Dynamic.cc)
target_link_libraries(CatTest3_Mock_Dynamic PRIVATE gtest_main gmock_main cat_module mock_dyn_iot_lib)

add_test(NAME CatTest3_Mock_Dynamic COMMAND CatTest3_Mock_Dynamic)

# ======================
# Mocking ì„¸ë²ˆì§¸ ì˜ˆì œ - ê°’ì„ ì¡°ì‘í•˜ê¸° (êµ¬í˜„ íŒŒì¼ êµì²´ ë° ì „ì—­ ë³€ìˆ˜ í™œìš©) (GMockì„ ì‚¬ìš©í•œ í•¨ìˆ˜ ì˜¤ë²„ë¼ì´ë”©)
add_library(iot_gmock_lib ${CMAKE_SOURCE_DIR}/mock/iot_gmock.cc)
include_directories(iot_gmock_lib PUBLIC ${CMAKE_SOURCE_DIR}/mock/)
target_link_libraries(iot_gmock_lib PRIVATE gmock_main)
add_executable(CatTest4_GMock CatTest4_GMock.cc)
target_link_libraries(CatTest4_GMock PRIVATE gtest_main gmock_main cat_module iot_gmock_lib)

add_test(NAME CatTest4_GMock COMMAND CatTest4_GMock)

# ======================
# Mocking ì„¸ë²ˆì§¸ ì˜ˆì œ - ê°’ì„ ì¡°ì‘í•˜ê¸° (êµ¬í˜„ íŒŒì¼ êµì²´ ë° ì „ì—­ ë³€ìˆ˜ í™œìš©) (GMockì„ ì‚¬ìš©í•œ í´ë˜ìŠ¤ ì˜¤ë²„ë¼ì´ë”©)
add_library(iot_gmock_class_lib ${CMAKE_SOURCE_DIR}/mock/iot_gmock_class.cc)
include_directories(iot_gmock_class_lib PUBLIC ${CMAKE_SOURCE_DIR}/mock/)
target_link_libraries(iot_gmock_class_lib PRIVATE gmock_main)
add_executable(CatTest5_GMock_Class CatTest5_GMock_Class.cc)
target_link_libraries(CatTest5_GMock_Class PRIVATE gtest_main gmock_main cat_module iot_gmock_class_lib)

add_test(NAME CatTest5_GMock_Class COMMAND CatTest5_GMock_Class)